# Redis 内存回收机制

Redis 是基于内存进行操作，而内存的重要性对Redis来说不言而喻，针对有限的内存，所以要进行内存回收。

其中一部分的内存回收主要依赖于：**过期删除策略**和**内存淘汰策略**

### 1.过期删除策略：

第一种：定时删除

当我们进行 set 的操作的使用，常常会附带过期时间，同时会为每一个 key 设置一个定时器，key 过期后，则通过定时器将过期的 key 进行删除。

**但缺点是同时占用了大量的内存来进行内存回收，从而影响 Redis 的可用内存大小、吞吐量和性能**

第二种：惰性删除

当访问一个 key 的时候，才会对 key 进行检查，如果过期就会删除，会在一定程度上节省 CPU 资源

**但对内存不太友好，若内存不被使用，则 key 不会被清除，从而占用大量的内存**

### 2. 内存淘汰策略

内存淘汰策略，指的是当 Redis 的使用内存到达 maxmemory 极限时，换句话说就是内存不足以容纳新的写入数据时，使用某种方法来清理数据，以保证数据存入。内存淘汰策略分为以下的的几种

1. noeviction: 写入会报错
2. allkeys-lru: 在键空间是一出最近最少使用的 key
3. allkeys-random: 在键空间随机移除某个使用的 key
4. volatile-lru: 在设置过期时间的键空间里，移除最近最少使用的 key
5. volatile-ttl: 在设置过期时间的键空间里，移除过期时间时间最少的 key



所以，一旦出现了 key 无法获取，则可以通过以上的思路来进行问题的排查



突然想起了一个故事，你就





