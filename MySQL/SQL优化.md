# SQL 优化

## 一、基本原则
主要是坚持三个原则
* 最大化利用索引
* 减少全表扫描
* 减少查询无用数据

首先要理解 [SQL的执行顺序](SQL的执行顺序.md)


### 1. 尽量避免不走索引

例如模糊查询时尽量将模糊字段放在查询关键字的末尾而并非头部

### 2. 尽量避免使用 IN 或者 NOT IN
使用 IN 或者 NOT IN 会放弃索引进行全表扫描

### 3. 尽量避免使用 OR
使用 OR 会导致放弃索引全表扫描

### 4. 尽量避免使用 NULL
使用 NULL 会导致放弃索引，进行全表扫描

### 5. 在使用 WHERE 语句避免在等号左边使用函数或表达式操作
会导致放弃索引全表扫描

### 6. 数据量大的时候避免使用 where 1 = 1

### 7. 查询时避免使用 <> 或 !=
应该改用其他的索引字段代替

### 8. WHERE 条件使用复合索引避免使用非前之列
例如三个字段是复合索引，其中应该尽可能使用时按照顺序，最左原则来，不要跳过

### 9. WHERE 的条件是 VARCHAR 时避免使用数值
例如 WHERE col_name = 123 从而导致隐式转换，不能正确的走索引

### 10. ORDER BY 应该尽可能与 WHERE 中的条件一致
否则 ORDER BY 不会通过索引进行排序


## 二、解决慢查询
### 1. 能否使用覆盖索引

### 2. 能否使用联合索引

### 3. 对索引进行表达式或函数运算会导致索引失效

### 4. 利用子查询 limit offset

### 5. 使用 explain 查看 SQL 的执行计划，查看是否走了索引

### 6. 尽可能减少锁持有的时间
在新增并修改的一个事务中，可以先