当在浏览器输入一个 github.com 的请求
浏览器会检查后缀是否有 ```.com``` 从而判断得出这不是一个搜索关键词，而是一个 Url，如果没有其他的东西，则会赋予一些默认值，例如 http:// ，80 端口以及 GET 方法，无基本的身份认证。

然后请求会先经过本地 DNS 解析或者去下一个节点进行 DNS 解析，直到找到 github.com 负载均衡的 IP 地址。可惜对网络底层不太了解，要不然也能对 TCP/IP 说个一二三四出来。

![](https://github.com/DraperHXY/Notes/blob/master/img/2019-01-24-1.png?raw=true)

接下来 github.com 回应说需要使用 https 307 内部重定向。因此原路返回到浏览器，浏览器将协议改为 https，默认使用 443 端口并重新发送，并使用 github 支持的什么协议 (TLS 1.0，1.1，1.2)，加密过后发送请求。

github 的负载均衡服务器会将请求放到网络应用防火墙的规则集上进行判断这是否是一个恶意的请求，如果不是则会将准备好的正文放在 http 响应中返回，可能有一些东西是早已经压缩好的。

浏览器会读取 github 的响应头，根据响应头的缓存策略进行缓存，然后将正文解压缩，可能有很多预渲染的内容，内联 CSS，JavaScript 和图像，用来减少网络请求和首次渲染时间。谁知道他们会做什么事情

此时可能还有一些额外的请求，可能本地保存了相关的 Cookie 或者是 OAuth 令牌的本地存储，这些东西都会发送到 github 用来认真我的身份，从而返回我的相关信息，昵称头像之类的...

我想即使是对网络在不熟悉的人都会听说过 OSI 七层模型
从上到下是 
* 应用层 - 出发请求的逻辑
* 表示层 - HTTP
* 会话层 - TLS
* 传输层 - TCP
* 网络层 - 路由(IP)
* 数据链路层 - 帧(数据单元)
* 物理层 - 比特流

我大概也就了解这么多了
[全新Chrome Devtool Performance使用指南](https://zhuanlan.zhihu.com/p/29879682)



[这是之前的原文](https://github.com/DraperHXY/Notes/issues/25)，后来再学习新的技术时，又有了新的理解



---

## 疑惑

在很久之前我就有过疑惑，什么是 Web 服务器，Nginx 和 Tomcat 之间的区别很明显，但是为什么都叫 Web 服务器



Nginx 给我们提供了什么？动静分离，负载均衡，反向代理

Tomcat 为我们提供了什么？一个处理 Web 请求的容器，再说特殊一点就是里面有解析 JSP 变成 Servlet 的 controller 控制层，有我们写的 business service。



但他们都是**围绕着 web 为中心**，为应用程序提供服务



## Http 服务器

在看到 TCP/IP 协议的时候，说到一个 socket 概念，即 socket 是 TCP/IP 暴露出来的 API 接口

我们写的程序通常是直接调用 Http，但基于 Http 无状态的特性，对于一些需求并不能很好的满足，例如服务器主动发送请求给客户端，我们都知道客户端发送 http 请求同时会立即有一个 Response 作为服务器的回应，即**请求-响应**的方式，除此之外，服务器并没有什么其他的机会主动发送给客户端，所以客户端会通过定期轮询访问的方式，不断地向服务器发送请求，服务器返回数据时顺便夹带私货…当然这样会耗费网络流量，客户端 CPU 等资源，基于 Http 有更好的方式，例如  ``SSE``、``Comet``，这些不是这篇文章的主题，就不多说了。



Http 服务器请求的原理



1、创建一个 ServerSocket，监听并 绑定一个端口

2、一些列客户端来请求这个端口

3、服务器使用 Accept，获得一个来自客户端的 Socket 连接对象

4、启动一个新线程处理连接

* 从 Socket 对象中读取字节流
* 解码协议，得到 Http 请求对象
* 处理 Http 请求，得到一个结果，封装成一个 HttpResponse 对象
* 编码协议，将结果序列化字节流
* 通过 Socket 对象，将字节流发送出去

不断重复步骤三



这就是 Http 服务器的原理，如果解析的协议是 Redis，那就会变成 Redis 服务器，如果解析的协议时 Ftp 协议，那么就会变成一个 Ftp 服务器、RPC、UDP、 或者 MySQL 的 Proxy 服务器都是同一个原理



## Socket 编程

Socket 网络编程就和 Win 编程一样，我们调用的是 TCP/IP 的 API，Win 用的是 Windows 系统开放的 API

Http 在 OSI 会话层的协议，底层的实现大部分都是 Socket，除非一些特殊领域。

理解了原理，就比较容易写代码了

网络上教程很多，就不说了，就这样

