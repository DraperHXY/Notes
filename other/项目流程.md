# 项目流程

 PM 提出 Story

然后开发根据 Story 来分析技术可行性，以及技术难度

根据原型图划分模块，进行人员安排，并规定接口

根据原型和接口来设计具体的实施方案

针对有疑点的问题尽量给出多个解决方案，并说明优缺点，然后进行方案评审

然后研发对模块进行拆分，方便对进度的统计，衡量，规划

接下来进行开发

其中包括自测



在每天都要开晨会对昨天的总结，今天的规划，以及可能遇到的问题，团队中需要合作的部分

每天晚上需要对代码进行持续集成，保证开发的方向，以及提前解决出现的 bug，避免后期难以解决

中间会使用 svn + git 和一些持续集成的框架...

在开发结束后需要对测试 PM 进行 demo，demo 成功了则正式发行,并且上测试环境进行系统测试

当测试成功后，则正式上生产环境，否则进行回滚到上一个版本





对于技术选型：

开发环境用什么样的服务器，域名，在哪里，谁去安排

测试环境，真实环境同上

用什么样的数据库，云存储，是否会用到第三方 API

对于 JDK 和 Maven 的版本尽可能保持一致，svn 共用一个仓库





对于部署到线上，需要将相关数据进行替换，例如真实的数据库IP以及密码

本地 hosts、以及注册中心等

需要通知运维进行确认



**注意邮件以及确定通知到人**







# 开发流程

## 一、有原型图分析 Story ``(产品)``，没有原型看文档 ``(开发) ``

> 有面向用户的那就需要产品，没有原型图那就设计原型图，里面的数据放真实数据(避免歧义和开发所谓的想当然)，如果产品不知道，那么产品就去问，直到问清楚
>
> 里面的数据，值都必须清楚是从何计算而来，不要让后端拍脑袋做决策，一会儿 A 一会儿 B，结果逻辑乱七八糟，数值都混淆了开发怎么搞



二、拆分模块``(开发)``

拆分业务模块，在拆分成小的模块，方便对业务统计，衡量，规划。

> 模块清清晰以为这代码的调用链清晰，不会出现有的模块的业务太重，有的模块几乎没有用到
>
> 代码不看过了几天，写的东西，该注意的事项全忘了。知道每个部分都有什么功能，都有什么需要重要的点



三、方案设计，评审``(开发，测试，负责人)``(这个是要花时间提前准备的，有过调查的)

1. 会用什么样的框架
2. 是否符合业务的需求
3. 是否需要有改动的地方，遇到问题了怎么办
4. 是否有更合适的方案

> 每次都是摸一个不熟悉的框架，根本赶不上进度

**以上是大的方面，但实际上还有很多小的问题**

1. 数据库主键是什么类型

   > 需要注意原框架中间的 id

2. 包的划分，工具类的划分

   > 

3. 命名的方式，dao 中到底是 getList 还是 selectList 还是 queryList 还是

   > 这些的优先级比较低，标准不是强制

4. API 的设计

   > 刚开始设置







```sql
SELECT * 
FROM court_dinner_suggestion
WHERE create_time 
BETWEEN '2019-01-01' AND '2019-09-09'
AND id IN 
```



# 本周完成的工作

* 小程序的接口全部调通
* 后台界面初具雏形

# 本周工作总结

1. 感觉吃了没有经验的亏，比如说需求不明确的情况下开发，很多东西都要返工

   > 刚开始说不用写前端，但后台没办法不管怎样也得上，这样下来，代码质量就比较差
   >
   > 因为前端不熟练，所以后端接口得顺着前端框架模板来，这就导致还得重新改接口，
   >
   > 写出来的代码质量也不好

   > 比如说有个排名接口，是 30 天环比，还是按月计算，得考虑月初的情况该怎么展示等

2. 对于每个人的分工问题，感觉没分好

3. 感觉时间没怎么用到位，看着一天真的很花时间的写代码，结果进度并不乐观

# 下周工作计划

彻底完成小程序，消除遗留的 Bug

# 需要协调和协助













|      |            周一             | 周二 | 周三 | 周四 | 周五 |
| :--: | :-------------------------: | ---- | ---- | ---- | :--: |
| 上午 |          重新整理           |      |      |      |      |
| 下午 |   界面按钮三个界面的删除    |      |      |      |      |
| 备注 | /user/user 总是会出现重定向 |      |      |      |      |



界面不多，就三个

有个 Shiro 的问题需要解决..

* Excel Support

* ```
  api/dinner/order/user/list
  ```







* 所有表格都要做成分页，返回结果我前面跟你说的 row,total,hasnext，分页和时间参数都是可选
* 所有的导出都要做成按照 id 导出的形式就是 idArray(具体其他有疑惑的问我)
* 所有的删除，全部整成批量删除，按照 idArray 删除



【杭州市对接】url = [http://183.136.177.64:39999/BDOFI/report/mainframe]







* 存在问题，接口泛滥，用不了





1. 业务模糊
2. 进度缓慢



```
eyJhbGciOiJIUzUxMiJ9.eyJwYXNzd29yZCI6IjEyMzQ1NiIsInVzZXJuYW1lIjoiYWRtaW4iLCJleHAiOjE1NjMxNTU1NTh9.As8fgZAQkg9nI0ataZpwwUIBWFXyY7or_qbooT3tIMlHMiumZBnE7BHsSC7hTXWfaDHj7u6W9BX3vxwaAjCm7Q
eyJhbGciOiJIUzUxMiJ9.eyJwYXNzd29yZCI6IjEyMzQ1NiIsInVzZXJuYW1lIjoiYWRtaW4iLCJleHAiOjE1NjMxNTU1NTh9.As8fgZAQkg9nI0ataZpwwUIBWFXyY7or_qbooT3tIMlHMiumZBnE7BHsSC7hTXWfaDHj7u6W9BX3vxwaAjCm7Q
```

```

```





org.springframework.web.filter.OncePerRequestFilter

``characterEncodingFilter``

``hiddenHttpMethodFilter``

``httpPutFormContentFilter``

``requestContextFilter``

``springShiroFilter``

``Tomcat WebSocket (JSR356)``

``org.apache.shiro.web.servlet.AbstractShiroFilter``

``org.springframework.web.servlet.HandlerExecutionChain`` // 获取一个 Handler 调用链



注意 ``AbstractShiroFilter``

```java
subject.execute(new Callable() {
    public Object call() throws Exception {
        updateSessionLastAccessTime(request, response);
        executeChain(request, response, chain);
        return null;
    }
});
```

> 设置回调函数，会对 session 进行 刷新，然后执行继续执行 过滤链

先进行 execute 然后再回调



进入 ``updateSessionLastAccessTime``

```java
if (!isHttpSessions()) { //'native' sessions
    Subject subject = SecurityUtils.getSubject();
    //Subject should never _ever_ be null, but just in case:
    if (subject != null) {
        Session session = subject.getSession(false);
        if (session != null) {
            try {
                session.touch();
            } catch (Throwable t) {
                log.error("session.touch() method invocation has failed.  Unable to update" +
                        "the corresponding session's last access time based on the incoming request.", t)
            }
        }
    }
}
```





然后继续进入过滤链

进入 ``org.apache.shiro.web.servlet.OncePerRequestFilter`` ，这个属于 Shiro 会进行一个 Filter 检查

``org.apache.shiro.web.servlet.AdviceFilter``



``org.apache.shiro.web.filter.PathMatchingFilter#preHandle``

```java
for (String path : this.appliedPaths.keySet()) {
    // If the path does match, then pass on to the subclass implementation for specific checks
    //(first match 'wins'):
    if (pathsMatch(path, request)) {
        log.trace("Current requestURI matches pattern '{}'.  Determining filter chain execution...", path);
        Object config = this.appliedPaths.get(path);
        return isFilterChainContinued(request, response, path, config);
    }
}
```

> 会对每个路径进行匹配，查看该路径所需要的权限，eg ``user:user:view``
>
> 



``org.springframework.web.servlet.DispatcherServlet#doDispatch`` // 所有请求的接收器





```java
HandlerExecutionChain mappedHandler = null;
// Determine handler for the current request.
// 看下有没有当前请求的 handler
mappedHandler = getHandler(processedRequest);
if (mappedHandler == null) {
	noHandlerFound(processedRequest, response);
	return;
}

// 如果有就继续获取 adapter
// org.springframework.web.servlet.HandlerAdapter
HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());



```



猫哥我在用你的框架的时候遇到了点问题

在访问 /user/user 列表的时候没有获得 subject







