# 初识分布式系统

* 分布式系统近些年都在做什么
* 为什么现在投入分布式系统的学习是值得的

## 分布式系统近些年都在做什么

分布式系统分为三部分

1. 分布式存储系统
2. 分布式计算系统
3. 分布式管理系统

### 分布式存储系统

1. 结构化存储
2. 非结构化存储
3. 半结构化存储
4. In-Memory 存储

除此之外还有一系列的理论，方法，技术作为支撑：例如 Paxos, CAP, ConsistentHash, Timing(时钟), 2PC, 3PC 等等

#### 结构化存储

典型场景就是事务处理系统或者关系型数据库。传统的机构化存储系统强调一下三点

* 结构化的数据(例如关系表)
* 强一致性(银行系统，电商系统等)
* 随机访问(索引，增删改查，SQL 语言)

结构化存储在可拓展性通常不是很好，这在一定程度上限制了在大数据环境下的表现。但还是有方法可以解决

####非结构化存储

非结构化存储强调的是高可拓展性，典型的系统就是分布式文件系统。Google 在 2003 年 SOSP 上推出的 GFS 是做出里程碑的一步，其开源实现有 HDFS, GFS。其主要思想包括

1. 用 master 来管理 metadata。
2. 文件使用 64MB 的 chunks 来存储，并且在不同的 server 上保存多个副本。
3. 自动容错，自动错误恢复。

和结构化存储系统相比，虽然分布式文件系统的可拓展性，吞吐率非常好，但是几乎无法支持随机访问操作，通常只能进行文件追加 (append) 操作。儿这样的限制使得非结构化存储系统很难面对那些低延时，实时性较强的应用。

#### 半结构化存储

比如 NoSQL, Key-Value Store，甚至包括对象存储，例如 protobuf, thrift 等等。

其中 NoSQL 近几年发展势头尤为强劲，NoSQL 系统具有分布式文件系统所具有的可拓展性，又有非结构化存储系统的随机访问能力，抛弃了传荣 RDBMS 里复杂的 SQL 查询以及 ACID 事务。

> 在 NoSQL 里比较有名系统包括：Google 的 Bigtable, Amazon 的 Dynamo, 以及开源界大名鼎鼎的 HBase，Cassandra 等.  通常这些 NoSQL 系统底层都是基于比较成熟的存储引擎，比如 Bigtable 就是基于 LevelDB ( jeff dean 写的，非常好的 C++ 源码教程) ，底层数据结构采用 LSM-Tree. 除了 LSM-Tree 之外 B-Tree （B+Tree）也是很成熟的存储引擎数据结构。

#### In-Memory 存储

将数据存储在内存中，从而获得读写的高性能。比较有名的系统包括 Memcached，Redis。

> 我们在之前提到，分布式存储系统有一系列的理论、算法、技术作为支撑：例如 *Paxos*, *CAP*, *Consistent Hash*, *Timing (时钟)*, *2PC, 3PC* 等等。那么如何掌握好这些技术呢？以我个人的经验，掌握这些内容一定要理解其对应的上下文。什么意思呢？就是一定要去思考为什么在当下环境需要某项技术，如果没有这个技术用其它技术替代是否可行，而不是一味的陷入大量的细节之中。例如：如何掌握好 Paxos?  Paxos本质上来说是一个三阶段提交，更 high level 讲是一个分布式锁。理解paxos必须一步一步从最简单的场景出发，比如从最简单的 master-backup 出发，发现不行，衍生出多数派读写，发现还是不行，再到 paxos.  之后再了解其变种，比如 fast paxos, multi-paxos. 同理为什么需要 Consistent Hash, 我们可以先思考如果用简单range partition 划分数据有什么问题。再比如学习 2pc, 3pc 这样的技术时，可以想想他们和paxos 有什么关系，能否替代 paxos。



## 分布式计算系统

首先得要解释分布式计算和并行计算

传统并行计算的要求是：投入更多的及其，数据大小不变，计算速度更快

分布式计算要求：投入更多的及其，能处理更大的数据。

换种说法就是两者出发点不相同，前者强调 high performance，后者强调 scalability.

**分布式计算的核心就是容错**

分布式计算系统也有一个简单的分类

1. 传统基于 msg 的系统
2. MapReduce-like 系统
3. 图计算系统
4. 基于状态的系统
5. Streaming 系统

### 传统基于 msg 的系统

具有代表性的就是 MPI，这些 msg 系统中最常用的就是 send 和 recv 接口，但不支持容错，几乎很难拓展到大规模集群中

### MapReduce-like 

这一类系统又叫做 dataflow 系统，其中以 MapReduce(Hadoop) 和 Spark 为代表。这一类系统的特点就是将计算抽象成为 high-level operator，例如像 map, reduce, filter 这样的函数算子，将其组合成为 DAG，然后由后端调度引擎进行并行化调度。这样的系统之所以能够在集群上运行，因为其就要较好的容错机制。

### 图计算系统

这里一类算是分布式计算的另一个分支，都是把计算过程抽象成图，然后再不同节点分布式执行。

### 基于状态的系统

主要被机器学习领域大规模运用