# 2PC 和 3PC

前面看了 网上很多讲 2PC，感觉都很混乱，我也讲不到



基础 2PC 的缺陷

> 高级 2PC 的优化就不说了

* 同步阻塞：在事务操作期间，所有资源处于阻塞状态
* 单点问题：协调者的角色极其重要，如果在阶段二处于阻塞，会使二阶段提交流程无法运转，其他的参与者将会一直处于锁定事务资源的状态
* 数据不一致：在二阶段，网络分区，假设协调者想所有参与者发送 commit，只有部分收到，会造成事务不一致
* 太过保守：在第二阶段参与者崩溃，往往依赖协调者的超时机制，通常情况下会选择回滚

容错机制比较差，任何一个节点的失败都会导致事务失败

2PC只有协调者有超时机制，参与者没有

3PC协调者和参与者都拥有超时机制



3PC 提供了超时机制

将阻塞范围和时间进行了优化，二阶段超时回滚，三阶段超时提交





