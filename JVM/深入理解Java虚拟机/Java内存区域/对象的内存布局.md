# 对象的内存布局

在 HotSpot 虚拟机中，对象在内存中存的布局可以分为 3 块区域

* 对象头(Header)
* 实例数据(Instance Data)
* 对象填充鞥(Padding)



## 一、对象头

在 HotSpot 虚拟机的对象头中包含两部分信息，第一部分用于存储池对象自身的运行时数据，如 HashCode、GC 分代年龄、锁状态标志、线程持有的锁、偏向线程 ID、偏向时间戳等，这部分数据的长度在 32 位和 64 为的虚拟机中分别为  32 bit 和 64 bit，官方称其为 MarkWord，实际上对象需要存储的运行时数据很多，其实已经超出了 32 位和 64 位锁能记录的限度，但是对象头信息是与对象自身定义的数据无关的额外存储成本，考虑到虚拟机的空间效率，Mark Word 被设计成一个非固定的数据结构以便在绩效的空间内存储尽量多的信息，他会根据对象的状态复用自己的存储空间。

另一部分是类型指针，即对象指向它的类元数据的指针，虚拟机通过这个指针来确定这个对象是哪个类的实例。



## 二、实例数据

实例数据时对象真正存储的有效信息，也是程序代码从中所定义的各种类型的字段内容。无论是从父类继承下来的，还是在子类中进行定义的，都需要记录起来。



## 三、对齐填充

这部分并不是必然存在的，也没有特别的含义，它仅仅起着占位符的作用。由于 HotSpot VM 的自动内存管理系统要求对象起始地址必须是 8 字节的整数倍，换句话说，就是对象的大小必须是 8 字节的整数倍。而对象头部分正好是 8 字节的一倍或者两倍。所以当对象实例数据没有对齐时，就需要通过对齐填充来不全



突然想起两篇以前看过的文章了，挺有意思

1. [盘一盘 synchronized （一）—— 从打印Java对象头说起](https://www.cnblogs.com/LemonFive/p/11246086.html)
2. [CPU Cache&Cache Line 与你写的代码之间究竟是怎样的关系呢？](https://mp.weixin.qq.com/s/zN3GaiXqkex4AV_vmX5fjw)

