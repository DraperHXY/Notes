### 类的双亲委派机制



#### 类加载器

根据全限定名称将 class 文件加载到 JVM 内存，转为 Class 对象。

有两种类加载器

* Bootstrap ClassLoader 启动类加载器

* Entension ClassLoader 其他类加载器



前者由 C++ 实现，将 <JAVA_HOME>\lib 目录或 -Xbootclasspath 参数指定的类库加载到内存中

后者由 Java 实现，继承自抽象类 ClassLoader 。如：

* Extension ClassLoader 扩展类加载器

加载 <JAVA_HOME>\lib\ext 目录或 java.ext.dirs 系统变量指定路径的所有类库

* Application ClassLoeader 应用程序类加载器

负责加载用户类路径(classpath) 上的指定类库，我们可以直接使用这个类加载器。一般情况下，如果我们没有自定义类加载器，默认就是使用这个类加载器。



#### 双亲委派机制

如果一个类加载器收到加载的请求，首先不会自己去尝试加载这个类，而是把这个请求委派给父类加载器完成。每个类加载器都是如此，只有当父加载器在自己的搜索范围找不到指定的类时，子加载器才会自己去加载。

越基础的类由越上层的加载器进行加载。基础类之所以成为基础，因为他们总是所谓被用户代码调用的 API



那这个机制有什么好处呢？

**可以保证 jvm 不回遇见重名的类，所有的基础类仅加载一次，保证了 Java 的安全性和稳定性。**





#### forName

我们使用 jdbc 驱动的时候回用到类加载

```java
Class.forName("com.mysql.cj.jdbc.Driver");
```

forName 是使用调用者 Class 对象的 ClassLoader 来加载目标类。在重载方法中也提供指定使用哪一个 ClassLoader 来加载



#### 自定义类加载器



#### Class.forName 和 ClassLoader.loadClass

他们的区别就是 Class.forName() 方法可以获取到原生类型的 Class，而 ClassLoader.loadClass 则会报错



#### 钻石依赖

指软件依赖导致同一个软件包的两个版本需要共存而不能冲突。

在 Maven 中遇到依赖冲突，会使用第一个来使用，如果不同版本的兼容性很糟糕，那么程序无法正确编译运行。Maven 将这种形式叫 ``扁平化`` 依赖管理。

使用 ClassLoader 可以解决钻石依赖问题。不同软件包使用不同的 ClassLoader 来加载，位于不同 ClassLoader 中名称一样的类实际上是不同的类。下面使用 URLClassLoader 来尝试一个简单的例子，他默认父加载器是  AppClassLoader



>**Java的虚拟机的面试内容主要包括三部分：GC、类加载机制，以及内存。**
>
>　　一个**GC部分简单的连环炮。**
>面试官可以先问你什么时候一个对象会被GC？
>　　接着继续问你为什么要在这种时候对象才会被GC？
>　　接着继续问你GC策略都有哪些分类？
>　　你如果说出来了，继续问你这些策略分别都有什么优劣势？都适用于什么场景？
>　　你继续说出来了以后，给你举个实际的场景，让你选择一个GC策略？
>　　你如果选出来了，继续问你，为什么要选择这个策略？
>
>**下面是关于类加载机制的简单连环炮。**
>首先肯定是先问你Java的类加载器都有哪些？
>　　回答了这些以后，可能会问你每个类加载器都加载哪些类？
>　　说完以后，可能会问你这些类加载之间的父子关系是怎样的？
>　　你在回答的时候可能会提到双亲委派模型，那么可以继续问你什么是双亲委派模型？
>　　你解释完了以后，可能会继续问你，为什么Java的类加载器要使用双亲委派模型？
>　　你回答完以后，可能会继续问你如何自定义自己的类加载器，自己的类加载器和Java自带的类加载器关系如何处理？
>
>**再来一个关于内存的连环炮。**
>首先肯定就是问你JVM内存分为哪几部分，这些部分分别都存储哪些数据？
>　　然后继续问你一个对象从创建到销毁都是怎么在这些部分里存活和转移的？
>　　接着可能会问你，内存的哪些部分会参与GC的回收？
>　　完事以后，可能还会问你Java的内存模型是怎么设计的？
>　　你回答了以后，还会继续问你为什么要这么设计？
>　　问完以后，还可能会让你结合内存模型的设计谈谈volatile关键字的作用？
>　　你在谈的时候，肯定会提到可见性，那么接着可见性这三个字，还可以继续问你并发的内容。
>
>[来源](<http://www.cnblogs.com/zuoxiaolong/p/life51.html>)

